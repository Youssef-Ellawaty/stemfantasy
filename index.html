<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙØ§Ù†ØªØ§Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --pink-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            --blue-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --purple-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            --gold-gradient: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            --bg-dark: #1a1d29;
            --card-dark: #2d3142;
            --text-light: #ffffff;
            --border-dark: #404654;
            --shadow-dark: 0 10px 30px rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Segoe UI', 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-dark);
            color: var(--text-light);
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #e74c3c 0%, #8e44ad 50%, #3498db 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-dark);
            margin-bottom: 2rem;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .admin-access {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
            font-size: 1.2rem;
        }

        .admin-access:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1) rotate(90deg);
        }

        .nav-tabs {
            background: var(--card-dark);
            padding: 0;
            margin: 2rem auto 0;
            max-width: 1200px;
            border-radius: 0;
            box-shadow: var(--shadow-dark);
            overflow: hidden;
            display: flex;
            flex-wrap: wrap;
        }

        .nav-tab {
            flex: 1;
            min-width: 120px;
            padding: 1rem;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            color: var(--text-light);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--blue-gradient);
            transition: all 0.3s ease;
            z-index: -1;
        }

        .nav-tab.active::before,
        .nav-tab:hover::before {
            left: 0;
        }

        .nav-tab.active,
        .nav-tab:hover {
            color: white;
            transform: translateY(-2px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-light);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-dark);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--bg-dark);
            color: var(--text-light);
        }

        .form-control:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: inherit;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 200px;
            height: 200px;
        }

        .btn-primary {
            background: var(--blue-gradient);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
        }

        .btn-warning {
            background: var(--warning-gradient);
            color: white;
        }

        .btn-danger {
            background: var(--danger-gradient);
            color: white;
        }

        .btn-gold {
            background: var(--gold-gradient);
            color: #333;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }

        .card {
            background: var(--card-dark);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-dark);
            transition: all 0.3s ease;
            border: 1px solid var(--border-dark);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }

        .player-card {
            background: var(--card-dark);
            border: 2px solid var(--border-dark);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            color: var(--text-light);
        }

        .player-card.selected {
            border-color: #4facfe;
            background: linear-gradient(135deg, var(--card-dark) 0%, #4facfe20 100%);
            transform: scale(1.02);
        }

        .player-card.captain {
            border-color: #ffd700;
            background: linear-gradient(135deg, var(--card-dark) 0%, #ffd70020 100%);
        }

        .player-card.triple-captain {
            border-color: #ffd700;
            background: linear-gradient(135deg, var(--card-dark) 0%, #ffd70040 100%);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .player-card:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-dark);
        }

        .player-name {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--text-light);
        }

        .player-team {
            color: #bbb;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .player-price {
            color: #4facfe;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .player-stats {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .formation {
            position: relative;
            width: 95%;
            max-width: 900px;
            margin: 20px auto;
            background: #4CAF50; /* Solid, vibrant green */
            min-height: 650px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border: 3px solid #fff; /* White border for pitch */
            
            /* Basic Pitch Lines */
            background-image: 
                /* Halfway line */
                linear-gradient(to right, #fff 0%, #fff 100%),
                /* Center circle */
                radial-gradient(circle at center, transparent 70px, #fff 70px, #fff 72px, transparent 72px),
                /* Left Penalty Box (Outline only) */
                linear-gradient(to right, #fff 0%, #fff 100%), /* Top line */
                linear-gradient(to bottom, #fff 0%, #fff 100%), /* Left line */
                linear-gradient(to left, #fff 0%, #fff 100%), /* Bottom line */
                /* Right Penalty Box (Outline only) */
                linear-gradient(to right, #fff 0%, #fff 100%), /* Top line */
                linear-gradient(to bottom, #fff 0%, #fff 100%), /* Right line */
                linear-gradient(to left, #fff 0%, #fff 100%); /* Bottom line */

            background-position: 
                center,
                center,
                10px calc(50% - 75px), /* Left penalty box top */
                10px 50%, /* Left penalty box left */
                10px calc(50% + 75px), /* Left penalty box bottom */
                calc(100% - 10px) calc(50% - 75px), /* Right penalty box top */
                calc(100% - 10px) 50%, /* Right penalty box right */
                calc(100% - 10px) calc(50% + 75px); /* Right penalty box bottom */

            background-size: 
                100% 2px, /* Halfway line */
                100% 100%, /* Center circle, full size for proper positioning */
                150px 2px, /* Left penalty box top */
                2px 150px, /* Left penalty box left */
                150px 2px, /* Left penalty box bottom */
                150px 2px, /* Right penalty box top */
                2px 150px, /* Right penalty box right */
                150px 2px; /* Right penalty box bottom */

            background-repeat: no-repeat;
        }

        .formation-position {
            position: absolute; /* Add absolute positioning */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .goalkeeper { top: 85%; left: 50%; transform: translateX(-50%); } /* Bottom center */
        .defender { top: 65%; left: 50%; transform: translateX(-50%); } /* Above GK, center */
        .midfielder-1 { top: 45%; left: 40%; transform: translateX(-50%); } /* Midfielder 1, left of center */
        .midfielder-2 { top: 45%; left: 60%; transform: translateX(-50%); } /* Midfielder 2, right of center */
        .forward { top: 10%; left: 50%; transform: translateX(-50%); } /* Top center */
        .substitute-1 { top: 30%; left: 15%; transform: translateX(-50%); } /* Sub1 raised even more, above halfway, left */
        .substitute-2 { top: 50%; left: 15%; transform: translateX(-50%); } /* Sub2 raised even more, below halfway, left */

        .position-slot {
            /* Ensure no default text or content is unexpectedly displayed here */
            width: 80px;
            height: 80px;
            border: 3px solid #fff; /* White solid border for empty slot */
            border-radius: 5px; /* Maintaining rectangular with slight roundness */
            display: flex;
            align-items: center;
            justify-content: center;
            background: #282c34; /* Dark gray background */
            color: white; /* White text for player position */
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .position-slot.filled {
            border: 3px solid #ffd700; /* Gold border for filled slot */
            background: rgba(255,215,0,0.2); /* Goldish background */
        }

        .position-slot.triple-captain {
            border: 3px solid #ffd700; /* Gold border for triple captain */
            background: rgba(255,215,0,0.4);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
        }

        .position-slot:hover {
            border-color: rgba(255,255,255,0.8); /* Slightly brighter white on hover for empty */
            background: rgba(255,255,255,0.1); /* Slight white transparency on hover for empty */
            transform: scale(1.1);
        }

        .position-slot.filled:hover {
            border-color: #ffd700; /* Maintain gold border on hover for filled */
            background: rgba(255,215,0,0.3); /* Slightly brighter goldish background on hover for filled */
        }

        .position-slot.player-removed {
            opacity: 0.4;
            border-color: var(--danger-gradient);
            background: rgba(255,107,107,0.2);
        }

        .position-slot.player-added {
            border-color: var(--success-gradient);
            background: rgba(76,201,240,0.2);
        }

        .budget-info {
            background: var(--warning-gradient);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: var(--shadow-dark);
        }

        .power-ups {
            background: var(--gold-gradient);
            color: #333;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-dark);
        }

        .power-up-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
        }

        .power-up-item:last-child {
            margin-bottom: 0;
        }

        .power-up-used {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .leaderboard {
            background: var(--card-dark);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow-dark);
        }

        .leaderboard-header {
            background: var(--primary-gradient);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-dark);
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            background: rgba(79, 172, 254, 0.1);
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .rank {
            font-weight: bold;
            color: var(--text-light);
            min-width: 40px;
        }

        .rank.gold { color: #ffd700; }
        .rank.silver { color: #c0c0c0; }
        .rank.bronze { color: #cd7f32; }

        .user-info {
            flex: 1;
            margin: 0 20px;
        }

        .username {
            font-weight: bold;
            color: var(--text-light);
        }

        .points {
            font-weight: bold;
            color: #4facfe;
            font-size: 1.1rem;
        }

        .login-container {
            max-width: 400px;
            margin: 50px auto;
            background: var(--card-dark);
            border-radius: 15px;
            padding: 40px;
            box-shadow: var(--shadow-dark);
            text-align: center;
            border: 1px solid var(--border-dark);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-dark);
            border-radius: 15px;
            padding: 30px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid var(--border-dark);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-dark);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            left: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 10px 20px;
            background: var(--border-dark);
            border: none;
            border-radius: 25px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-tab.active {
            background: var(--blue-gradient);
        }

        .match-card {
            background: var(--card-dark);
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .match-card:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .match-info {
            text-align: center;
            color: #bbb;
            font-size: 0.9rem;
        }

        .match-score {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #4facfe;
        }

        .match-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .match-status.upcoming {
            background: var(--warning-gradient);
            color: white;
        }

        .match-status.finished {
            background: var(--success-gradient);
            color: white;
        }

        .round-section {
            margin-bottom: 30px;
        }

        .round-header {
            background: var(--primary-gradient);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .p-20 { padding: 20px; }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
            
            .formation {
                min-height: 400px; /* Further adjust height for smaller mobile */
                margin: 10px auto;
                padding: 5px; /* Reduce padding even more for mobile */
                /* Adjust background-size for lines on mobile if needed, keeping it simple */
                background-size: 
                    100% 1px, /* Halfway line */
                    100% 100%, 
                    80px 1px, /* Penalty box lines */
                    1px 80px,
                    80px 1px,
                    80px 1px,
                    1px 80px,
                    80px 1px; 
            }
            
            .position-slot {
                width: 50px; /* Even smaller slots for very small screens */
                height: 50px;
                font-size: 0.6rem;
            }

            /* Adjust specific player positions for mobile responsiveness */
            .goalkeeper {
                top: 85%;
                left: 50%;
                transform: translateX(-50%);
            }

            .defender {
                top: 65%;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                flex-direction: row;
                gap: 5px;
            }

            .midfielder-1 {
                top: 45%; /* Midfielder 1 */
                left: 40%;
                transform: translateX(-50%);
                display: flex;
                flex-direction: row;
                gap: 5px;
            }

            .midfielder-2 {
                top: 45%; /* Midfielder 2, same top as mid1 */
                left: 60%;
                transform: translateX(-50%);
                display: flex;
                flex-direction: row;
                gap: 5px;
            }

            .forward {
                top: 10%;
                left: 50%;
                transform: translateX(-50%);
            }

            .substitute-1 {
                top: 40%; /* Sub1 above halfway, left */
                left: 15%;
                transform: translateX(-50%);
            }

            .substitute-2 {
                top: 60%; /* Sub2 below halfway, left */
                left: 15%;
                transform: translateX(-50%);
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
        }

        .transfers-section {
            background: var(--card-dark);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-dark);
        }

        .transfers-header {
            background: var(--primary-gradient);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        .transfer-info {
            background: rgba(79, 172, 254, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid rgba(79, 172, 254, 0.3);
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginScreen" class="login-container">
        <h2 style="color: var(--text-light); margin-bottom: 30px;">ğŸ† Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙØ§Ù†ØªØ§Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</h2>
        
        <div id="loginForm">
            <h3 style="margin-bottom: 20px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
            <div class="form-group">
                <input type="text" id="loginUsername" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            </div>
            <div class="form-group">
                <input type="password" id="loginPassword" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            <button onclick="login()" class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="showRegister()" class="btn btn-warning" style="width: 100%;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <div id="registerForm" class="hidden">
            <h3 style="margin-bottom: 20px;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
            <div class="form-group">
                <input type="text" id="regUsername" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            </div>
            <div class="form-group">
                <input type="password" id="regPassword" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            <div class="form-group">
                <input type="text" id="regTeamName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚">
            </div>
            <button onclick="register()" class="btn btn-success" style="width: 100%; margin-bottom: 10px;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
            <button onclick="showLogin()" class="btn btn-warning" style="width: 100%;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="mainApp" class="hidden">
        <div class="header">
            <button class="admin-access" onclick="showAdminLogin()">âš™ï¸</button>
            <h1>ğŸ† Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙØ§Ù†ØªØ§Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</h1>
            <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="currentUser"></span> | ÙØ±ÙŠÙ‚: <span id="currentTeam"></span></p>
            <button onclick="logout()" class="btn btn-danger" style="margin-top: 10px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('teamFormation')">ğŸ”¥ ØªØ´ÙƒÙŠÙ„ØªÙŠ</button>
            <button class="nav-tab" onclick="showTab('matches')">âš½ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</button>
            <button class="nav-tab" onclick="showTab('leaderboard')">ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨</button>
            <button class="nav-tab" onclick="showTab('playerStats')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        </div>

        <div class="container">
            <!-- ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„ÙØ±ÙŠÙ‚ -->
            <div id="teamFormation" class="tab-content active">
                <div class="budget-info">
                    Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span id="remainingBudget">45.0</span> Ù…Ù„ÙŠÙˆÙ†
                </div>

                <div class="power-ups">
                    <h4 style="margin-bottom: 15px;">ğŸ’ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ©</h4>
                    <div class="power-up-item" id="tripleCaptainCard">
                        <span>ğŸ‘‘ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† (Ù†Ù‚Ø§Ø· Ã— 3)</span>
                        <button id="tripleCaptainBtn" class="btn btn-gold" onclick="useTripleCaptain()">Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>
                    </div>
                    <div class="power-up-item" id="benchBoostCard">
                        <span>ğŸš€ Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª (Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨Ø¯Ù„Ø§Ø¡)</span>
                        <button id="benchBoostBtn" class="btn btn-gold" onclick="useBenchBoost()">Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ØªØ´ÙƒÙŠÙ„Ø© ÙØ±ÙŠÙ‚Ùƒ</h3>
                            <button class="btn btn-primary" id="toggleTransferModeBtn" onclick="toggleTransferMode()">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</button>
                        </div>
                        <div class="formation">
                            <div class="formation-position goalkeeper">
                                <div class="position-slot" data-position="goalkeeper" onclick="handlePlayerSlotClick('goalkeeper')">
                                </div>
                                <small>Ø­Ø§Ø±Ø³ Ø§Ù„Ù…Ø±Ù…Ù‰</small>
                            </div>
                            
                            <div class="formation-position defender">
                                <div class="position-slot" data-position="defender" onclick="handlePlayerSlotClick('defender')">
                                </div>
                                <small>Ù…Ø¯Ø§ÙØ¹</small>
                            </div>
                            
                            <div class="formation-position midfielder-1">
                                <div class="position-slot" data-position="midfielder1" onclick="handlePlayerSlotClick('midfielder1')">
                                    <span>ÙˆØ³Ø·</span>
                                </div>
                                <small>ÙˆØ³Ø· Ø£ÙˆÙ„</small>
                            </div>
                            
                            <div class="formation-position midfielder-2">
                                <div class="position-slot" data-position="midfielder2" onclick="handlePlayerSlotClick('midfielder2')">
                                    <span>ÙˆØ³Ø·</span>
                                </div>
                                <small>ÙˆØ³Ø· Ø«Ø§Ù†ÙŠ</small>
                            </div>
                            
                            <div class="formation-position forward">
                                <div class="position-slot" data-position="forward" onclick="handlePlayerSlotClick('forward')">
                                    <span>Ù…Ù‡Ø§Ø¬Ù…</span>
                                </div>
                                <small>Ù…Ù‡Ø§Ø¬Ù…</small>
                            </div>
                            
                            <div class="formation-position substitute-1">
                                <div class="position-slot" data-position="substitute1" onclick="handlePlayerSlotClick('substitute1')">
                                    <span>Ø¨Ø¯ÙŠÙ„</span>
                                </div>
                                <small>Ø¨Ø¯ÙŠÙ„ Ø£ÙˆÙ„</small>
                            </div>
                            
                            <div class="formation-position substitute-2">
                                <div class="position-slot" data-position="substitute2" onclick="handlePlayerSlotClick('substitute2')">
                                    <span>Ø¨Ø¯ÙŠÙ„</span>
                                </div>
                                <small>Ø¨Ø¯ÙŠÙ„ Ø«Ø§Ù†ÙŠ</small>
                            </div>
                        </div>
                        
                        <div class="mt-20" id="transferActionButtons" class="hidden">
                            <button class="btn btn-success" onclick="saveTransfers()">Ø­ÙØ¸ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª</button>
                            <button class="btn btn-danger" onclick="discardTransfers()">ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª</button>
                        </div>
                        
                        <div class="mt-20">
                            <h4>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒØ§Ø¨ØªÙ†:</h4>
                            <select id="captainSelect" class="form-control" onchange="setCaptain()">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒØ§Ø¨ØªÙ†</option>
                            </select>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚</h3>
                        <div id="teamInfo">
                            <div class="card" style="background: var(--primary-gradient);">
                                <div style="text-align: center; color: white;">
                                    <div style="font-size: 2rem; font-weight: bold;" id="totalPoints">0</div>
                                    <div>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</div>
                                </div>
                            </div>
                            <div class="card mt-20" style="background: var(--success-gradient);">
                                <div style="text-align: center; color: white;">
                                    <div style="font-size: 2rem; font-weight: bold;" id="roundPoints">0</div>
                                    <div>Ù†Ù‚Ø§Ø· Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©</div>
                                </div>
                            </div>
                            <div class="card mt-20" style="background: var(--warning-gradient);">
                                <div style="text-align: center; color: white;">
                                    <div style="font-size: 2rem; font-weight: bold;" id="teamValue">0</div>
                                    <div>Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ (Ù…Ù„ÙŠÙˆÙ†)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª -->
                <!-- Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø³ÙŠØªÙ… Ø¥Ø²Ø§Ù„ØªÙ‡ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ -->
            </div>

            <!-- Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª -->
            <div id="matches" class="tab-content">
                <div id="matchesContainer"></div>
            </div>

            <!-- Ø§Ù„ØªØ±ØªÙŠØ¨ -->
            <div id="leaderboard" class="tab-content">
                <div class="grid grid-2">
                    <div class="leaderboard">
                        <div class="leaderboard-header">ğŸ† ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</div>
                        <div id="totalLeaderboard"></div>
                    </div>
                    <div class="leaderboard">
                        <div class="leaderboard-header">âš¡ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
                        <div id="roundLeaderboard"></div>
                    </div>
                </div>
            </div>

            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
            <div id="playerStats" class="tab-content">
                <div class="grid grid-4">
                    <div class="leaderboard">
                        <div class="leaderboard-header">âš½ Ø£ÙƒØ«Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ØªÙ‡Ø¯ÙŠÙØ§Ù‹</div>
                        <div id="topScorers"></div>
                    </div>
                    <div class="leaderboard">
                        <div class="leaderboard-header">ğŸ‘Ÿ Ø£ÙƒØ«Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ØªÙ…Ø±ÙŠØ±Ø§Ù‹ Ø­Ø§Ø³Ù…Ø§Ù‹</div>
                        <div id="topAssisters"></div>
                    </div>
                    <div class="leaderboard">
                        <div class="leaderboard-header">ğŸŸ¨ Ø£ÙƒØ«Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¥Ù†Ø°Ø§Ø±Ø§Ù‹</div>
                        <div id="mostYellowCards"></div>
                    </div>
                    <div class="leaderboard">
                        <div class="leaderboard-header">ğŸŸ¥ Ø£ÙƒØ«Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø·Ø±Ø¯Ø§Ù‹</div>
                        <div id="mostRedCards"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <button class="close-modal" onclick="closeAdminLogin()">&times;</button>
            <div class="modal-header">
                <h3>ğŸ” Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
            </div>
            <div class="form-group">
                <input type="password" id="adminPassword" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">
            </div>
            <button onclick="checkAdminPassword()" class="btn btn-primary" style="width: 100%;">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
    <div id="adminModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <button class="close-modal" onclick="closeAdmin()">&times;</button>
            <div class="modal-header">
                <h3>âš™ï¸ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙØ§Ù†ØªØ§Ø²ÙŠ</h3>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="showAdminTab('rounds')">ğŸ“… Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</button>
                <button class="admin-tab" onclick="showAdminTab('matches')">âš½ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</button>
                <button class="admin-tab" onclick="showAdminTab('teams')">ğŸŸï¸ Ø§Ù„ÙØ±Ù‚</button>
                <button class="admin-tab" onclick="showAdminTab('players')">ğŸ‘¨â€ğŸ¦° Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</button>
                <button class="admin-tab" onclick="showAdminTab('users')">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
                <button class="admin-tab" onclick="showAdminTab('points')">ğŸ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø§Ø·</button>
            </div>

            <div id="adminRounds" class="admin-content">
                <h4>ğŸ“… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</h4>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¬ÙˆÙ„Ø©:</label>
                        <input type="text" id="roundName" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰">
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</label>
                        <input type="datetime-local" id="roundStartDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</label>
                        <input type="datetime-local" id="roundEndDate" class="form-control">
                    </div>
                </div>
                <button onclick="createRound()" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                <div id="roundsList" class="mt-20"></div>
            </div>

            <div id="adminMatches" class="admin-content hidden">
                <h4>âš½ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h4>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label>Ø§Ù„Ø¬ÙˆÙ„Ø©:</label>
                        <select id="matchRound" class="form-control">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬ÙˆÙ„Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„:</label>
                        <select id="team1" class="form-control">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
                        <select id="team2" class="form-control">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©:</label>
                        <input type="datetime-local" id="matchDateTime" class="form-control">
                    </div>
                </div>
                <button onclick="createMatch()" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø±Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                <div id="adminMatchesList" class="mt-20"></div>
            </div>

            <div id="adminTeams" class="admin-content hidden">
                <h4>ğŸŸï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±Ù‚</h4>
                <div class="form-group">
                    <input type="text" id="newTeamName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                </div>
                <button onclick="addTeam()" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© ÙØ±ÙŠÙ‚</button>
                <div id="teamsList" class="mt-20"></div>
            </div>

            <div id="adminPlayers" class="admin-content hidden">
                <h4>ğŸ‘¨â€ğŸ¦° Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h4>
                <div class="admin-form-grid">
                    <input type="hidden" id="editPlayerId">
                    <div class="form-group">
                        <input type="text" id="newPlayerName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">
                    </div>
                    <div class="form-group">
                        <select id="newPlayerTeam" class="form-control">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <select id="newPlayerPosition" class="form-control">
                            <option value="goalkeeper">Ø­Ø§Ø±Ø³ Ù…Ø±Ù…Ù‰</option>
                            <option value="defender">Ù…Ø¯Ø§ÙØ¹</option>
                            <option value="midfielder">ÙˆØ³Ø·</option>
                            <option value="forward">Ù…Ù‡Ø§Ø¬Ù…</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <input type="number" id="newPlayerPrice" class="form-control" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¨Ø§Ù„Ù…Ù„ÙŠÙˆÙ†)" step="0.1">
                    </div>
                </div>
                <button onclick="savePlayer()" class="btn btn-success" id="savePlayerBtn">Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨</button>
                <div id="playersAdminList" class="mt-20"></div>
            </div>
            
            <div id="adminUsers" class="admin-content hidden">
                <h4>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h4>
                <div class="admin-actions">
                    <input type="text" id="deleteUserSearch" class="form-control" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø­Ø°Ù">
                    <button class="btn btn-danger mt-20" onclick="confirmDeleteUser()">Ø­Ø°Ù Ø­Ø³Ø§Ø¨</button>
                </div>
                <div id="usersAdminList" class="mt-20"></div>
            </div>

            <div id="adminPoints" class="admin-content hidden">
                <h4>ğŸ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø§Ø·</h4>
                <div class="grid grid-3">
                    <div class="form-group">
                        <label>Ø§Ù„Ù„Ø§Ø¹Ø¨:</label>
                        <select id="pointsPlayerId" class="form-control">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù„Ø§Ø¹Ø¨</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¬ÙˆÙ„Ø©:</label>
                        <select id="pointsRound" class="form-control">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬ÙˆÙ„Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©:</label>
                        <input type="number" id="directPoints" class="form-control" value="0">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù âš½:</label>
                        <input type="number" id="playerGoals" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ØªÙ…Ø±ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ø³Ù…Ø© ğŸ‘Ÿ:</label>
                        <input type="number" id="playerAssists" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØµÙØ±Ø§Ø¡ ğŸŸ¨:</label>
                        <input type="number" id="playerYellowCards" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ ğŸŸ¥:</label>
                        <input type="number" id="playerRedCards" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group" id="savesMGroup" style="display: none;">
                        <label>Ø§Ù„ØªØµØ¯ÙŠØ§Øª (Ø­Ø±Ø§Ø³) ğŸ¥…:</label>
                        <input type="number" id="playerSaves" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="playerInjured"> Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…ØµØ§Ø¨/ØºØ§Ø¦Ø¨
                        </label>
                    </div>
                </div>
                <button onclick="updatePlayerPoints()" class="btn btn-success">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
    <div id="playerSelectionModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closePlayerSelection()">&times;</button>
            <div class="modal-header">
                <h3>Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨</h3>
            </div>
            
            <div class="form-group">
                <input type="text" id="playerSearchInput" class="form-control" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù„Ø§Ø¹Ø¨..." onkeyup="filterPlayers()">
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button class="btn btn-primary" data-position="all" onclick="filterByPosition('all')">Ø§Ù„ÙƒÙ„</button>
                <button class="btn btn-warning" data-position="goalkeeper" onclick="filterByPosition('goalkeeper')">Ø­Ø±Ø§Ø³</button>
                <button class="btn btn-warning" data-position="defender" onclick="filterByPosition('defender')">Ù…Ø¯Ø§ÙØ¹ÙŠÙ†</button>
                <button class="btn btn-warning" data-position="midfielder" onclick="filterByPosition('midfielder')">ÙˆØ³Ø·</button>
                <button class="btn btn-warning" data-position="forward" onclick="filterByPosition('forward')">Ù…Ù‡Ø§Ø¬Ù…ÙŠÙ†</button>
            </div>
            
            <div id="availablePlayers" class="grid grid-3"></div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© -->
    <div id="matchStatsModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeMatchStats()">&times;</button>
            <div class="modal-header">
                <h3 id="matchStatsTitle">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</h3>
            </div>
            <div id="matchStatsContent"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api/'; // Your Node.js API base URL (for local development)

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
        let gameData = {
            users: [],
            teams: [
                { id: 1, name: "Ø§Ù„Ø£Ù‡Ù„ÙŠ" },
                { id: 2, name: "Ø§Ù„Ø²Ù…Ø§Ù„Ùƒ" },
                { id: 3, name: "Ø¨ÙŠØ±Ø§Ù…ÙŠØ¯Ø²" },
                { id: 4, name: "Ø§Ù„Ù…ØµØ±ÙŠ" }
            ],
            players: [],
            rounds: [],
            matches: [],
            currentUser: null,
            currentRound: 1,
            maxPlayersPerTeam: 2,
            adminPassword: "admin123",
            stagedTeam: null, // New: for temporary player changes
            stagedBudget: 0,   // New: for temporary budget during transfers
            isTransferMode: false, // New: flag to indicate transfer mode
            // New: power-up pending rounds, these will be set for the next round and activated on round start
            pendingTripleCaptainRound: null,
            pendingBenchBoostRound: null
        };

        // Ù…ØªØºÙŠØ± Ù„Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹
        let currentSelectionPosition = '';

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        function initializeData() {
            // Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ÙŠÙ† ØªØ¬Ø±ÙŠØ¨ÙŠÙŠÙ†
            const samplePlayers = [
                // Ø§Ù„Ø£Ù‡Ù„ÙŠ
                { id: 1, name: "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù†Ø§ÙˆÙŠ", team: "Ø§Ù„Ø£Ù‡Ù„ÙŠ", position: "goalkeeper", price: 3.5, stats: { rounds: {} }, injured: false },
                { id: 2, name: "ÙŠØ§Ø³Ø± Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", team: "Ø§Ù„Ø£Ù‡Ù„ÙŠ", position: "defender", price: 4.2, stats: { rounds: {} }, injured: false },
                { id: 3, name: "Ø£Ù„ÙŠÙˆ Ø¯ÙŠØ§Ù†Øº", team: "Ø§Ù„Ø£Ù‡Ù„ÙŠ", position: "midfielder", price: 5.8, stats: { rounds: {} }, injured: false },
                { id: 4, name: "Ù…Ø­Ù…Ø¯ Ø´Ø±ÙŠÙ", team: "Ø§Ù„Ø£Ù‡Ù„ÙŠ", position: "forward", price: 6.5, stats: { rounds: {} }, injured: false },
                
                // Ø§Ù„Ø²Ù…Ø§Ù„Ùƒ
                { id: 5, name: "Ù…Ø­Ù…Ø¯ Ø¹ÙˆØ§Ø¯", team: "Ø§Ù„Ø²Ù…Ø§Ù„Ùƒ", position: "goalkeeper", price: 3.2, stats: { rounds: {} }, injured: false },
                { id: 6, name: "Ø­Ø§Ø²Ù… Ø¥Ù…Ø§Ù…", team: "Ø§Ù„Ø²Ù…Ø§Ù„Ùƒ", position: "defender", price: 3.8, stats: { rounds: {} }, injured: false },
                { id: 7, name: "Ø¥Ù…Ø§Ù… Ø¹Ø§Ø´ÙˆØ±", team: "Ø§Ù„Ø²Ù…Ø§Ù„Ùƒ", position: "midfielder", price: 5.5, stats: { rounds: {} }, injured: false },
                { id: 8, name: "Ø³ÙŠÙ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø²ÙŠØ±ÙŠ", team: "Ø§Ù„Ø²Ù…Ø§Ù„Ùƒ", position: "forward", price: 5.9, stats: { rounds: {} }, injured: false },
                
                // Ø¨ÙŠØ±Ø§Ù…ÙŠØ¯Ø²
                { id: 9, name: "Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´Ù†Ø§ÙˆÙŠ", team: "Ø¨ÙŠØ±Ø§Ù…ÙŠØ¯Ø²", position: "goalkeeper", price: 3.0, stats: { rounds: {} }, injured: false },
                { id: 10, name: "Ø£Ø³Ø§Ù…Ø© Ø¬Ù„Ø§Ù„", team: "Ø¨ÙŠØ±Ø§Ù…ÙŠØ¯Ø²", position: "defender", price: 3.5, stats: { rounds: {} }, injured: false },
                { id: 11, name: "Ø±Ù…Ø¶Ø§Ù† ØµØ¨Ø­ÙŠ", team: "Ø¨ÙŠØ±Ø§Ù…ÙŠØ¯Ø²", position: "midfielder", price: 6.2, stats: { rounds: {} }, injured: false },
                { id: 12, name: "ÙØ®Ø± Ø§Ù„Ø¯ÙŠÙ† Ø¨Ù† ÙŠÙˆØ³Ù", team: "Ø¨ÙŠØ±Ø§Ù…ÙŠØ¯Ø²", position: "forward", price: 5.7, stats: { rounds: {} }, injured: false },
                
                // Ø§Ù„Ù…ØµØ±ÙŠ
                { id: 13, name: "Ù…Ø­Ù…Ø¯ ØµØ¨Ø­ÙŠ", team: "Ø§Ù„Ù…ØµØ±ÙŠ", position: "goalkeeper", price: 2.8, stats: { rounds: {} }, injured: false },
                { id: 14, name: "Ø£Ø­Ù…Ø¯ ØªÙˆÙÙŠÙ‚", team: "Ø§Ù„Ù…ØµØ±ÙŠ", position: "defender", price: 3.2, stats: { rounds: {} }, injured: false },
                { id: 15, name: "Ù…Ø±ÙˆØ§Ù† Ø­Ù…Ø¯ÙŠ", team: "Ø§Ù„Ù…ØµØ±ÙŠ", position: "midfielder", price: 4.8, stats: { rounds: {} }, injured: false },
                { id: 16, name: "Ø¹Ù…Ø±Ùˆ Ù…Ø±Ø¹ÙŠ", team: "Ø§Ù„Ù…ØµØ±ÙŠ", position: "forward", price: 4.5, stats: { rounds: {} }, injured: false }
            ];

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            const savedData = localStorage.getItem('fantasyLeagueData');
            if (savedData) {
                gameData = { ...gameData, ...JSON.parse(savedData) };
            } else {
                gameData.players = samplePlayers;
                // Ø¥Ø¶Ø§ÙØ© Ø¬ÙˆÙ„Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                gameData.rounds = [{
                    id: 1,
                    name: "Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰",
                    startDate: new Date().toISOString(),
                    endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
                }];
                saveGameData();
            }

            // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                gameData.currentUser = JSON.parse(currentUser);
                showMainApp();
            } else {
                showLoginScreen();
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function saveGameData() {
            localStorage.setItem('fantasyLeagueData', JSON.stringify(gameData));
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!username || !password) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }

            const user = gameData.users.find(u => u.username === username && u.password === password);
            if (user) {
                gameData.currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showMainApp();
            } else {
                alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
        function register() {
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value.trim();
            const teamName = document.getElementById('regTeamName').value.trim();

            if (!username || !password || !teamName) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            if (gameData.users.find(u => u.username === username)) {
                alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
                return;
            }

            const newUser = {
                id: Date.now(),
                username,
                password,
                teamName,
                team: {
                    goalkeeper: null,
                    defender: null,
                    midfielder1: null,
                    midfielder2: null,
                    forward: null,
                    substitute1: null,
                    substitute2: null,
                    captain: null,
                    tripleCaptain: null, // Ø¬Ø¯ÙŠØ¯
                    tripleCaptainUsed: false,
                    benchBoostUsed: false,
                    benchBoostRound: null,
                    freeTransfers: 0 // New property for free transfers
                },
                budget: 45,
                totalPoints: 0,
                roundPoints: {},
                transfersRemaining: 2,
                freeTransfers: 0, // New property for free transfers
                powerUps: {
                    tripleCaptainUsed: false,
                    benchBoostUsed: false,
                    pendingTripleCaptainRound: null, // New: for next round's triple captain
                    pendingBenchBoostRound: null    // New: for next round's bench boost
                }
            };

            gameData.users.push(newUser);
            gameData.currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            saveGameData();
            showMainApp();
        }

        // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function showLogin() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            localStorage.removeItem('currentUser');
            gameData.currentUser = null;
            showLoginScreen();
        }

        // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            document.getElementById('currentUser').textContent = gameData.currentUser.username;
            document.getElementById('currentTeam').textContent = gameData.currentUser.teamName;
            
            updateUI();
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function showTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            if (tabName === 'matches') {
                updateMatchesDisplay();
            } else if (tabName === 'leaderboard') {
                updateLeaderboards();
            } else if (tabName === 'playerStats') {
                updatePlayerStats();
            } else if (tabName === 'teamFormation') {
                // updateTransferOptions(); // Removed as transfer logic is now integrated
            }
        }

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ†
        function useTripleCaptain() {
            if (isGameweekActive()) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¬Ø§Ø±ÙŠØ©! ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„Ù‡ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.');
                return;
            }
            if (gameData.currentUser.powerUps.tripleCaptainUsed) {
                alert('Ù„Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù…Øª Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† Ù…Ù† Ù‚Ø¨Ù„!');
                return;
            }
            if (gameData.currentUser.powerUps.pendingTripleCaptainRound === gameData.currentRound + 1) {
                alert('Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† Ù„Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©!');
                return;
            }
            if (gameData.currentUser.powerUps.benchBoostUsed || gameData.currentUser.powerUps.pendingBenchBoostRound === gameData.currentRound + 1) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† ÙˆØ§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¬ÙˆÙ„Ø©!');
                return;
            }

            if (!gameData.currentUser.team.captain) {
                alert('ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± ÙƒØ§Ø¨ØªÙ† Ø£ÙˆÙ„Ø§Ù‹!');
                return;
            }

            const nextRoundId = gameData.currentRound + 1;
            const nextRound = gameData.rounds.find(r => r.id === nextRoundId);

            if (!nextRound) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬ÙˆÙ„Ø© Ù‚Ø§Ø¯Ù…Ø© Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† ÙÙŠÙ‡Ø§.');
                return;
            }

            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† Ù„Ù„Ø¬ÙˆÙ„Ø© ${nextRound.name}ØŸ Ù„Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!`)) {
                gameData.currentUser.powerUps.pendingTripleCaptainRound = nextRoundId;
                // Don't set tripleCaptain yet, it will be set when the round starts
                // gameData.currentUser.team.tripleCaptain = gameData.currentUser.team.captain;
                // gameData.currentUser.team.tripleCaptainRound = gameData.currentRound;
                
                updateUserData();
                updatePowerUpsDisplay();
                alert(`ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† Ù„Ù„Ø¬ÙˆÙ„Ø© ${nextRound.name}! Ø³ÙŠØ­ØµÙ„ Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ø¹Ù„Ù‰ 3 Ø£Ø¶Ø¹Ø§Ù Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ ØªÙ„Ùƒ Ø§Ù„Ø¬ÙˆÙ„Ø©.`);
            }
        }

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª
        function useBenchBoost() {
            if (isGameweekActive()) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¬Ø§Ø±ÙŠØ©! ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„Ù‡ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.');
                return;
            }
            if (gameData.currentUser.powerUps.benchBoostUsed) {
                alert('Ù„Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù…Øª Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª Ù…Ù† Ù‚Ø¨Ù„!');
                return;
            }
            if (gameData.currentUser.powerUps.pendingBenchBoostRound === gameData.currentRound + 1) {
                alert('Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª Ù„Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©!');
                return;
            }
            if (gameData.currentUser.powerUps.tripleCaptainUsed || gameData.currentUser.powerUps.pendingTripleCaptainRound === gameData.currentRound + 1) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† ÙˆØ§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¬ÙˆÙ„Ø©!');
                return;
            }

            const nextRoundId = gameData.currentRound + 1;
            const nextRound = gameData.rounds.find(r => r.id === nextRoundId);

            if (!nextRound) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬ÙˆÙ„Ø© Ù‚Ø§Ø¯Ù…Ø© Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª ÙÙŠÙ‡Ø§.');
                return;
            }

            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª Ù„Ù„Ø¬ÙˆÙ„Ø© ${nextRound.name}ØŸ Ù„Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!`)) {
                gameData.currentUser.powerUps.pendingBenchBoostRound = nextRoundId;
                // Don't set benchBoostUsed or benchBoostRound yet, it will be set when the round starts
                // gameData.currentUser.powerUps.benchBoostUsed = true;
                // gameData.currentUser.team.benchBoostRound = gameData.currentRound;
                
                updateUserData();
                updatePowerUpsDisplay();
                alert(`ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª Ù„Ù„Ø¬ÙˆÙ„Ø© ${nextRound.name}! Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¨Ø¯Ù„Ø§Ø¡ ÙÙŠ ØªÙ„Ùƒ Ø§Ù„Ø¬ÙˆÙ„Ø©.`);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
        function updatePowerUpsDisplay() {
            const tripleCaptainCard = document.getElementById('tripleCaptainCard');
            const benchBoostCard = document.getElementById('benchBoostCard');
            const tripleCaptainBtn = document.getElementById('tripleCaptainBtn');
            const benchBoostBtn = document.getElementById('benchBoostBtn');
            const tripleCaptainSpan = tripleCaptainCard.querySelector('span');
            const benchBoostSpan = benchBoostCard.querySelector('span');

            // Reset state
            tripleCaptainCard.classList.remove('power-up-used', 'power-up-pending');
            benchBoostCard.classList.remove('power-up-used', 'power-up-pending');
            tripleCaptainBtn.style.display = 'inline-flex';
            benchBoostBtn.style.display = 'inline-flex';
            tripleCaptainSpan.textContent = 'ğŸ‘‘ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† (Ù†Ù‚Ø§Ø· Ã— 3)';
            benchBoostSpan.textContent = 'ğŸš€ Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª (Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨Ø¯Ù„Ø§Ø¡)';

            // Triple Captain Logic
            if (gameData.currentUser.powerUps.tripleCaptainUsed) {
                tripleCaptainCard.classList.add('power-up-used');
                tripleCaptainBtn.style.display = 'none';
                tripleCaptainSpan.textContent = 'ğŸ‘‘ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† (ØªÙ… Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…)';
            } else if (gameData.currentUser.powerUps.pendingTripleCaptainRound) {
                const nextRound = gameData.rounds.find(r => r.id === gameData.currentUser.powerUps.pendingTripleCaptainRound);
                if (nextRound) {
                    tripleCaptainCard.classList.add('power-up-pending');
                    tripleCaptainBtn.style.display = 'none';
                    tripleCaptainSpan.textContent = `ğŸ‘‘ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ† (Ù…ÙØ¹Ù„ Ù„Ù„Ø¬ÙˆÙ„Ø© ${nextRound.name})`;
                }
            }

            // Bench Boost Logic
            if (gameData.currentUser.powerUps.benchBoostUsed) {
                benchBoostCard.classList.add('power-up-used');
                benchBoostBtn.style.display = 'none';
                benchBoostSpan.textContent = 'ğŸš€ Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª (ØªÙ… Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…)';
            } else if (gameData.currentUser.powerUps.pendingBenchBoostRound) {
                const nextRound = gameData.rounds.find(r => r.id === gameData.currentUser.powerUps.pendingBenchBoostRound);
                if (nextRound) {
                    benchBoostCard.classList.add('power-up-pending');
                    benchBoostBtn.style.display = 'none';
                    benchBoostSpan.textContent = `ğŸš€ Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª (Ù…ÙØ¹Ù„ Ù„Ù„Ø¬ÙˆÙ„Ø© ${nextRound.name})`;
                }
            }

            // Disable buttons if any power-up is active or pending
            if (gameData.currentUser.powerUps.tripleCaptainUsed || gameData.currentUser.powerUps.pendingTripleCaptainRound ||
                gameData.currentUser.powerUps.benchBoostUsed || gameData.currentUser.powerUps.pendingBenchBoostRound) {
                tripleCaptainBtn.disabled = true;
                benchBoostBtn.disabled = true;
            } else {
                tripleCaptainBtn.disabled = false;
                benchBoostBtn.disabled = false;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateUserData() {
            const userIndex = gameData.users.findIndex(u => u.id === gameData.currentUser.id);
            if (userIndex !== -1) {
                gameData.users[userIndex] = gameData.currentUser;
            }
            saveGameData();
            localStorage.setItem('currentUser', JSON.stringify(gameData.currentUser));
        }

        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø³ØªÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ...
        // [ØªÙƒÙ…Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø±Ø¯ Ø§Ù„ØªØ§Ù„ÙŠ]

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        function showAdminLogin() {
            document.getElementById('adminLoginModal').classList.add('active');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        function closeAdminLogin() {
            document.getElementById('adminLoginModal').classList.remove('active');
            document.getElementById('adminPassword').value = '';
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === gameData.adminPassword) {
                closeAdminLogin();
                document.getElementById('adminModal').classList.add('active');
                updateAdminData(); // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
            } else {
                alert('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©.');
            }
        }

        // Add event listener for Enter key on admin password input
        document.addEventListener('DOMContentLoaded', () => {
            const adminPasswordInput = document.getElementById('adminPassword');
            if (adminPasswordInput) {
                adminPasswordInput.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        event.preventDefault(); // Prevent default form submission
                        checkAdminPassword();
                    }
                });
            }
        });

        function closeAdminModal() {
            document.getElementById('adminModal').classList.remove('active');
        }

        // Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ù… ØªØ¹Ø¯ Ù…Ø³ØªØ®Ø¯Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©)
        // function showAdmin() {
        //     document.getElementById('adminModal').classList.add('active');
        //     updateAdminData(); // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
        // }

        // Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        function closeAdmin() {
            document.getElementById('adminModal').classList.remove('active');
        }

        // ØªØ¨Ø¯ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        function showAdminTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
            document.querySelectorAll('.admin-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById('admin' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.remove('hidden');
            event.target.classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            if (tabName === 'matches') {
                updateAdminMatchesList();
                updateMatchRoundOptions();
            } else if (tabName === 'players') {
                updatePlayerTeamOptions();
            } else if (tabName === 'users') {
                updateUsersList();
            } else if (tabName === 'points') {
                updatePlayerPointsOptions();
                updatePointsRoundOptions();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        function updateAdminData() {
            updateRoundsList();
            updateTeamsList();
            updateTeamOptions();
            updatePlayersAdminList(); // Add this line to update players list
            updateUsersList(); // Add this line to update users list
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function createRound() {
            const name = document.getElementById('roundName').value.trim();
            const startDate = document.getElementById('roundStartDate').value;
            const endDate = document.getElementById('roundEndDate').value;

            if (!name || !startDate || !endDate) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            const newRound = {
                id: Date.now(),
                name,
                startDate,
                endDate
            };

            gameData.rounds.push(newRound);
            gameData.currentRound = newRound.id;
            
            // Activate pending power-ups for all users for the new current round
            gameData.users.forEach(user => {
                // Activate Triple Captain if pending for this round
                if (user.powerUps.pendingTripleCaptainRound === newRound.id) {
                    user.powerUps.tripleCaptainUsed = true;
                    user.team.tripleCaptain = user.team.captain;
                    user.team.tripleCaptainRound = newRound.id;
                    user.powerUps.pendingTripleCaptainRound = null; // Clear pending status
                }
                // Activate Bench Boost if pending for this round
                if (user.powerUps.pendingBenchBoostRound === newRound.id) {
                    user.powerUps.benchBoostUsed = true;
                    user.team.benchBoostRound = newRound.id;
                    user.powerUps.pendingBenchBoostRound = null; // Clear pending status
                }
                user.transfersRemaining = 2;
            });
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('roundName').value = '';
            document.getElementById('roundStartDate').value = '';
            document.getElementById('roundEndDate').value = '';
            
            saveGameData();
            updateRoundsList();
            alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆÙ„Ø§Øª
        function updateRoundsList() {
            const container = document.getElementById('roundsList');
            container.innerHTML = '';
            
            gameData.rounds.forEach(round => {
                const roundDiv = document.createElement('div');
                roundDiv.className = 'card';
                roundDiv.innerHTML = `
                    <h5>${round.name}</h5>
                    <p>Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: ${new Date(round.startDate).toLocaleDateString('ar-EG')}</p>
                    <p>Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: ${new Date(round.endDate).toLocaleDateString('ar-EG')}</p>
                    <button onclick="deleteRound(${round.id})" class="btn btn-danger">Ø­Ø°Ù</button>
                `;
                container.appendChild(roundDiv);
            });
        }

        function deleteRound(roundId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø§ Ø£ÙŠØ¶Ø§Ù‹.')) {
                gameData.rounds = gameData.rounds.filter(round => round.id !== roundId);
                gameData.matches = gameData.matches.filter(match => match.roundId !== roundId); // Ø­Ø°Ù Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¬ÙˆÙ„Ø©
                saveGameData();
                updateRoundsList();
                updateMatchRoundOptions(); // Refresh match round options
                updatePointsRoundOptions(); // Refresh points round options
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¨Ø§Ø±Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function createMatch() {
            const roundId = document.getElementById('matchRound').value;
            const team1 = document.getElementById('team1').value;
            const team2 = document.getElementById('team2').value;
            const dateTime = document.getElementById('matchDateTime').value;

            if (!roundId || !team1 || !team2 || !dateTime) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            if (team1 === team2) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙ„Ø¹Ø¨ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¶Ø¯ Ù†ÙØ³Ù‡!');
                return;
            }

            const newMatch = {
                id: Date.now(),
                roundId: parseInt(roundId),
                team1,
                team2,
                dateTime,
                status: 'upcoming',
                score: { team1: null, team2: null },
                stats: {
                    team1: { goals: [], assists: [], yellowCards: [], redCards: [] },
                    team2: { goals: [], assists: [], yellowCards: [], redCards: [] }
                }
            };

            gameData.matches.push(newMatch);
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('matchRound').value = '';
            document.getElementById('team1').value = '';
            document.getElementById('team2').value = '';
            document.getElementById('matchDateTime').value = '';
            
            saveGameData();
            updateAdminMatchesList();
            alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ù„Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
        function updateMatchRoundOptions() {
            const select = document.getElementById('matchRound');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬ÙˆÙ„Ø©</option>';
            
            gameData.rounds.forEach(round => {
                const option = document.createElement('option');
                option.value = round.id;
                option.textContent = round.name;
                select.appendChild(option);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙØ±Ù‚
        function updateTeamOptions() {
            const selects = ['team1', 'team2'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚</option>';
                    
                    gameData.teams.forEach(team => {
                        const option = document.createElement('option');
                        option.value = team.name;
                        option.textContent = team.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ÙÙŠ Ø§Ù„ØªÙƒÙ…Ù„Ø©...
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
        function updateMatchesDisplay() {
            const container = document.getElementById('matchesContainer');
            container.innerHTML = '';

            if (gameData.rounds.length === 0) {
                container.innerHTML = '<div class="card text-center"><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬ÙˆÙ„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</h3></div>';
                return;
            }

            gameData.rounds.forEach(round => {
                const roundMatches = gameData.matches.filter(match => match.roundId === round.id);
                
                const roundDiv = document.createElement('div');
                roundDiv.className = 'round-section';
                
                roundDiv.innerHTML = `
                    <div class="round-header">${round.name}</div>
                    <div id="round-${round.id}-matches"></div>
                `;
                
                container.appendChild(roundDiv);
                
                const matchesContainer = document.getElementById(`round-${round.id}-matches`);
                
                if (roundMatches.length === 0) {
                    matchesContainer.innerHTML = '<div class="card text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©</div>';
                } else {
                    roundMatches.forEach(match => {
                        const matchCard = document.createElement('div');
                        matchCard.className = 'match-card';
                        matchCard.onclick = () => showMatchStats(match);
                        
                        const matchDate = new Date(match.dateTime);
                        const now = new Date();
                        const isFinished = now > matchDate;
                        
                        matchCard.innerHTML = `
                            <div class="match-teams">
                                <div style="font-weight: bold;">${match.team1}</div>
                                <div class="match-score">
                                    ${match.score.team1 !== null ? `${match.score.team1} - ${match.score.team2}` : 'VS'}
                                </div>
                                <div style="font-weight: bold;">${match.team2}</div>
                            </div>
                            <div class="match-info">
                                ${matchDate.toLocaleDateString('ar-EG')} - ${matchDate.toLocaleTimeString('ar-EG', {hour: '2-digit', minute: '2-digit'})}
                                <span class="match-status ${isFinished ? 'finished' : 'upcoming'}">
                                    ${isFinished ? 'Ø§Ù†ØªÙ‡Øª' : 'Ù‚Ø§Ø¯Ù…Ø©'}
                                </span>
                            </div>
                        `;
                        
                        matchesContainer.appendChild(matchCard);
                    });
                }
            });
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
        function showMatchStats(match) {
            const modal = document.getElementById('matchStatsModal');
            const title = document.getElementById('matchStatsTitle');
            const content = document.getElementById('matchStatsContent');
            
            title.textContent = `${match.team1} VS ${match.team2}`;
            
            const matchDate = new Date(match.dateTime);
            const now = new Date();
            const isFinished = now > matchDate;
            
            if (!isFinished) {
                content.innerHTML = `
                    <div class="card text-center">
                        <h4>Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ù„Ù… ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯</h4>
                        <p>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©: ${matchDate.toLocaleDateString('ar-EG')} - ${matchDate.toLocaleTimeString('ar-EG')}</p>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="grid grid-2">
                        <div class="card">
                            <h4>${match.team1}</h4>
                            <div class="mb-20">
                                <strong>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù âš½:</strong>
                                ${match.stats.team1.goals.map(goal => `<div>${goal.player} (${goal.minute}')</div>`).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‡Ø¯Ø§Ù'}
                            </div>
                            <div class="mb-20">
                                <strong>Ø§Ù„ØªÙ…Ø±ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ø³Ù…Ø© ğŸ‘Ÿ:</strong>
                                ${match.stats.team1.assists.map(assist => `<div>${assist.player} (${assist.minute}')</div>`).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ…Ø±ÙŠØ±Ø§Øª Ø­Ø§Ø³Ù…Ø©'}
                            </div>
                            <div class="mb-20">
                                <strong>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØµÙØ±Ø§Ø¡ ğŸŸ¨:</strong>
                                ${match.stats.team1.yellowCards.map(card => `<div>${card.player} (${card.minute}')</div>`).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª ØµÙØ±Ø§Ø¡'}
                            </div>
                            <div>
                                <strong>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ ğŸŸ¥:</strong>
                                ${match.stats.team1.redCards.map(card => `<div>${card.player} (${card.minute}')</div>`).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª Ø­Ù…Ø±Ø§Ø¡'}
                            </div>
                        </div>
                        <div class="card">
                            <h4>${match.team2}</h4>
                            <div class="mb-20">
                                <strong>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù âš½:</strong>
                                ${match.stats.team2.goals.map(goal => `<div>${goal.player} (${goal.minute}')</div>`).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‡Ø¯Ø§Ù'}
                            </div>
                            <div class="mb-20">
                                <strong>Ø§Ù„ØªÙ…Ø±ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ø³Ù…Ø© ğŸ‘Ÿ:</strong>
                                ${match.stats.team2.assists.map(assist => `<div>${assist.player} (${assist.minute}')</div>`).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ…Ø±ÙŠØ±Ø§Øª Ø­Ø§Ø³Ù…Ø©'}
                            </div>
                            <div class="mb-20">
                                <strong>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØµÙØ±Ø§Ø¡ ğŸŸ¨:</strong>
                                ${match.stats.team2.yellowCards.map(card => `<div>${card.player} (${card.minute}')</div>`).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª ØµÙØ±Ø§Ø¡'}
                            </div>
                            <div>
                                <strong>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ ğŸŸ¥:</strong>
                                ${match.stats.team2.redCards.map(card => `<div>${card.player} (${card.minute}')</div>`).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª Ø­Ù…Ø±Ø§Ø¡'}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            modal.classList.add('active');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
        function closeMatchStats() {
            document.getElementById('matchStatsModal').classList.remove('active');
        }

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        async function openPlayerSelection(slotKey, forceOpen = false) {
            if (!gameData.isTransferMode && !forceOpen) {
                alert('Ù„Ø¥Ø¬Ø±Ø§Ø¡ ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            if (await isGameweekActive()) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¬Ø§Ø±ÙŠØ©!');
                return;
            }
            currentSelectionPosition = slotKey;
            let filterPosition = '';

            if (slotKey.includes('goalkeeper')) filterPosition = 'goalkeeper';
            else if (slotKey.includes('defender')) filterPosition = 'defender';
            else if (slotKey.includes('midfielder')) filterPosition = 'midfielder';
            else if (slotKey.includes('forward')) filterPosition = 'forward';
            else if (slotKey.includes('substitute')) filterPosition = 'all'; // Substitutes can be any position
            
            document.getElementById('playerSelectionModal').classList.add('active');
            await displayAvailablePlayers(filterPosition);
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        function closePlayerSelection() {
            document.getElementById('playerSelectionModal').classList.remove('active');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†
        function displayAvailablePlayers(filterPositionParam) {
            const container = document.getElementById('availablePlayers');
            container.innerHTML = '';
            
            let filteredPlayers = gameData.players.filter(player => {
                // Use filterPosition here
                if (filterPositionParam !== 'all' && player.position !== filterPositionParam) {
                    return false;
                }
                
                // Determine which team to check against (staged or current) and which budget to use
                const teamToCheck = gameData.isTransferMode ? gameData.stagedTeam : gameData.currentUser.team;
                const budgetToCheck = gameData.isTransferMode ? gameData.stagedBudget : gameData.currentUser.budget;

                // ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„ÙŠØ³ ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ø§Ù„ÙØ¹Ù„ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨)
                const isInTeam = Object.values(teamToCheck).some(selectedPlayer => 
                    selectedPlayer && selectedPlayer.id === player.id
                );
                
                if (isInTeam) return false;
                
                // ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø§ ÙŠÙ…Ù„Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨)
                const teamPlayersCount = Object.values(teamToCheck).filter(selectedPlayer => 
                    selectedPlayer && selectedPlayer.team === player.team
                ).length;
                
                if (teamPlayersCount >= gameData.maxPlayersPerTeam) return false;
                
                // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©)
                if (player.price > budgetToCheck) return false;
                
                return true;
            });
            
            // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø«
            const searchTerm = document.getElementById('playerSearchInput').value.toLowerCase();
            if (searchTerm) {
                filteredPlayers = filteredPlayers.filter(player => 
                    player.name.toLowerCase().includes(searchTerm) ||
                    player.team.toLowerCase().includes(searchTerm)
                );
            }
            
            filteredPlayers.forEach(player => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                playerCard.onclick = () => selectPlayer(player);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
                const totalGoals = Object.values(player.stats.rounds).reduce((sum, round) => sum + (round.goals || 0), 0);
                const totalAssists = Object.values(player.stats.rounds).reduce((sum, round) => sum + (round.assists || 0), 0);
                const totalYellowCards = Object.values(player.stats.rounds).reduce((sum, round) => sum + (round.yellowCards || 0), 0);
                const totalRedCards = Object.values(player.stats.rounds).reduce((sum, round) => sum + (round.redCards || 0), 0);
                
                playerCard.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="player-team">${player.team}</div>
                    <div class="player-price">${player.price} Ù…Ù„ÙŠÙˆÙ†</div>
                    <div class="player-stats">
                        <span class="stat-item">âš½ ${totalGoals}</span>
                        <span class="stat-item">ğŸ‘Ÿ ${totalAssists}</span>
                        <span class="stat-item">ğŸŸ¨ ${totalYellowCards}</span>
                        <span class="stat-item">ğŸŸ¥ ${totalRedCards}</span>
                    </div>
                `;
                
                container.appendChild(playerCard);
            });
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨
        function selectPlayer(player) {
            if (gameData.isTransferMode) {
                gameData.stagedTeam[currentSelectionPosition] = { ...player };
                gameData.stagedBudget -= player.price;
            } else {
            gameData.currentUser.team[currentSelectionPosition] = { ...player };
            gameData.currentUser.budget -= player.price;
            }
            
            // Only update user data immediately if not in transfer mode. Otherwise, it will be updated by saveTransfers().
            if (!gameData.isTransferMode) {
            updateUserData();
            }
            closePlayerSelection();
            updateUI();
        }

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        function filterPlayers() {
            // Re-call displayAvailablePlayers with the current filter position, which is now derived from currentSelectionPosition
            let filterPosition = '';
            if (currentSelectionPosition.includes('goalkeeper')) filterPosition = 'goalkeeper';
            else if (currentSelectionPosition.includes('defender')) filterPosition = 'defender';
            else if (currentSelectionPosition.includes('midfielder')) filterPosition = 'midfielder';
            else if (currentSelectionPosition.includes('forward')) filterPosition = 'forward';
            else if (currentSelectionPosition.includes('substitute')) filterPosition = 'all';
            
            displayAvailablePlayers(filterPosition);
        }

        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±ÙƒØ²
        function filterByPosition(position) {
            // When filtering by position in the modal, we need to apply the filter, but keep the original slotKey for selection
            let actualFilterPosition = position;
            if (position === 'all') {
                // If 'all' is selected, and we are in a substitute slot, keep 'all' for filtering
                if (currentSelectionPosition.includes('substitute')) {
                    actualFilterPosition = 'all';
                } else {
                    // If 'all' is selected for a main slot, effectively remove position filtering
                    actualFilterPosition = ''; // No position filter
                }
            }
            displayAvailablePlayers(actualFilterPosition);
        }

        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒØ§Ø¨ØªÙ†
        function setCaptain() {
            if (isGameweekActive()) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¬Ø§Ø±ÙŠØ©!');
                // Reset the select box to the current captain if there is one
                const currentCaptainId = gameData.currentUser.team.captain;
                document.getElementById('captainSelect').value = currentCaptainId || '';
                return;
            }
            const captainSelect = document.getElementById('captainSelect');
            const selectedPlayerId = parseInt(captainSelect.value);
            
            if (selectedPlayerId) {
                gameData.currentUser.team.captain = selectedPlayerId;
                updateUserData();
                updateFormationDisplay();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function updateUI() {
            calculateRemainingBudget(); // Ensure budget is calculated before display
            updateBudgetDisplay();
            updateFormationDisplay();
            updateCaptainOptions();
            updateTeamStats();
            updatePowerUpsDisplay();
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ±ÙŠÙ‚
        function calculateRemainingBudget() {
            let teamValue = 0;
            const teamToCalculate = gameData.isTransferMode ? gameData.stagedTeam : gameData.currentUser.team;
            
            Object.keys(teamToCalculate).forEach(position => {
                if (['captain', 'tripleCaptain', 'tripleCaptainUsed', 'benchBoostUsed', 'benchBoostRound', 'freeTransfers'].includes(position)) return;
                if (teamToCalculate[position]) {
                    teamValue += teamToCalculate[position].price;
                }
            });
            
            if (gameData.isTransferMode) {
                gameData.stagedBudget = 45 - teamValue;
            } else {
                gameData.currentUser.budget = 45 - teamValue;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©
        function updateBudgetDisplay() {
            const budgetToDisplay = gameData.isTransferMode ? gameData.stagedBudget : gameData.currentUser.budget;
            document.getElementById('remainingBudget').textContent = 
                budgetToDisplay.toFixed(1);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©
        function updateFormationDisplay() {
            const currentTeam = gameData.currentUser.team;
            const teamToDisplay = gameData.isTransferMode ? gameData.stagedTeam : currentTeam;
            
            Object.keys(teamToDisplay).forEach(position => {
                if (['captain', 'tripleCaptain', 'tripleCaptainUsed', 'benchBoostUsed', 'benchBoostRound'].includes(position)) return;
                
                const slot = document.querySelector(`[data-position="${position}"]`);
                if (slot) {
                    // Reset classes
                    slot.classList.remove('filled', 'triple-captain', 'player-removed', 'player-added');

                    const playerInDisplay = teamToDisplay[position];
                    const playerInCurrent = currentTeam[position];

                    if (playerInDisplay) {
                        slot.innerHTML = ''; // Clear existing content before filling with player data
                        slot.classList.add('filled');
                        
                        // Check for Triple Captain
                        if (teamToDisplay.tripleCaptain === playerInDisplay.id && teamToDisplay.tripleCaptainRound === gameData.currentRound) {
                            slot.classList.add('triple-captain');
                        }

                        // Visual indication for transfers
                        if (gameData.isTransferMode) {
                            if (!playerInCurrent) {
                                slot.classList.add('player-added');
                            } else if (playerInCurrent.id !== playerInDisplay.id) {
                                // This case means a player was swapped, so it's both removed and added.
                                // We'll prioritize 'added' visual if a new player is in the slot.
                                // Or we could add a 'player-swapped' class if needed.
                                slot.classList.add('player-added');
                            }
                        }
                        
                        slot.innerHTML = `
                            <div style="text-align: center;">
                                <div style="font-size: 0.8rem; font-weight: bold;">${playerInDisplay.name}</div>
                                <div style="font-size: 0.7rem;">${playerInDisplay.team}</div>
                                ${teamToDisplay.captain === playerInDisplay.id ? '<div style="color: #ffd700;">ğŸ‘‘</div>' : ''}
                                ${teamToDisplay.tripleCaptain === playerInDisplay.id && teamToDisplay.tripleCaptainRound === gameData.currentRound ? '<div style="color: #ffd700;">ğŸ‘‘ğŸ‘‘ğŸ‘‘</div>' : ''}
                            </div>
                        `;
                    } else {
                        // Slot is empty
                        slot.innerHTML = ''; // Clear existing content first
                        if (gameData.isTransferMode && playerInCurrent) {
                            slot.classList.add('player-removed'); // Visually indicate player was removed
                        }
                        const positionNames = {
                            goalkeeper: 'Ø­Ø§Ø±Ø³',
                            defender: 'Ù…Ø¯Ø§ÙØ¹',
                            midfielder1: 'ÙˆØ³Ø·',
                            midfielder2: 'ÙˆØ³Ø·',
                            forward: 'Ù…Ù‡Ø§Ø¬Ù…',
                            substitute1: 'Ø¨Ø¯ÙŠÙ„',
                            substitute2: 'Ø¨Ø¯ÙŠÙ„'
                        };
                        slot.innerHTML += `<span>${positionNames[position]}</span>`; // Add only the relevant span
                    }
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙƒØ§Ø¨ØªÙ†
        function updateCaptainOptions() {
            const captainSelect = document.getElementById('captainSelect');
            captainSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒØ§Ø¨ØªÙ†</option>';
            
            const team = gameData.currentUser.team;
            Object.keys(team).forEach(position => {
                if (['captain', 'tripleCaptain', 'tripleCaptainUsed', 'benchBoostUsed', 'benchBoostRound'].includes(position) || !team[position]) return;
                
                const option = document.createElement('option');
                option.value = team[position].id;
                option.textContent = `${team[position].name} (${team[position].team})`;
                
                if (team.captain === team[position].id) {
                    option.selected = true;
                }
                
                captainSelect.appendChild(option);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙØ±ÙŠÙ‚
        function updateTeamStats() {
            let totalPoints = 0;
            let roundPoints = 0;
            let teamValue = 0;
            
            const team = gameData.currentUser.team;
            Object.keys(team).forEach(position => {
                if (['captain', 'tripleCaptain', 'tripleCaptainUsed', 'benchBoostUsed', 'benchBoostRound'].includes(position) || !team[position]) return;
                
                const player = team[position];
                teamValue += player.price;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª
                Object.values(player.stats.rounds).forEach(roundStats => {
                    let playerPoints = (roundStats.goals || 0) * 4 + (roundStats.assists || 0) * 3 - (roundStats.yellowCards || 0) * 1 - (roundStats.redCards || 0) * 3;
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· Ø§Ù„ØªØµØ¯ÙŠØ§Øª Ù„Ù„Ø­Ø±Ø§Ø³
                    if (player.position === 'goalkeeper') {
                        playerPoints += (roundStats.saves || 0) * 1;
                    }
                    
                    totalPoints += Math.max(0, playerPoints);
                });
                
                // Ø­Ø³Ø§Ø¨ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                const currentRoundStats = player.stats.rounds[gameData.currentRound] || {};
                let currentPlayerPoints = (currentRoundStats.goals || 0) * 4 + (currentRoundStats.assists || 0) * 3 - (currentRoundStats.yellowCards || 0) * 1 - (currentRoundStats.redCards || 0) * 3;
                
                if (player.position === 'goalkeeper') {
                    currentPlayerPoints += (currentRoundStats.saves || 0) * 1;
                }
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø¶Ø§Ø¹Ù Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ø£Ùˆ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ†
                if (team.captain === player.id) {
                    if (team.tripleCaptain === player.id && team.tripleCaptainRound === gameData.currentRound) {
                        currentPlayerPoints *= 3; // Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ†
                    } else {
                        currentPlayerPoints *= 2; // Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                    }
                }
                
                roundPoints += Math.max(0, currentPlayerPoints);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨Ø¯Ù„Ø§Ø¡ Ø¥Ø°Ø§ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª
            if (team.benchBoostRound === gameData.currentRound) {
                ['substitute1', 'substitute2'].forEach(position => {
                    if (team[position]) {
                        const player = team[position];
                        const currentRoundStats = player.stats.rounds[gameData.currentRound] || {};
                        let benchPlayerPoints = (currentRoundStats.goals || 0) * 4 + (currentRoundStats.assists || 0) * 3 - (currentRoundStats.yellowCards || 0) * 1 - (currentRoundStats.redCards || 0) * 3;
                        
                        if (player.position === 'goalkeeper') {
                            benchPlayerPoints += (currentRoundStats.saves || 0) * 1;
                        }
                        
                        roundPoints += Math.max(0, benchPlayerPoints);
                    }
                });
            }
            
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('roundPoints').textContent = roundPoints;
            document.getElementById('teamValue').textContent = teamValue.toFixed(1);
            
            // ØªØ­Ø¯ÙŠØ« Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            gameData.currentUser.totalPoints = totalPoints;
            if (!gameData.currentUser.roundPoints) {
                gameData.currentUser.roundPoints = {};
            }
            gameData.currentUser.roundPoints[gameData.currentRound] = roundPoints;
            
            updateUserData();
        }

        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù (Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§ØªØŒ Ø§Ù„Ù„ÙˆØ­Ø§ØªØŒ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©...)
        // [Ø§Ù„ÙƒÙˆØ¯ Ø³ÙŠÙƒÙ…Ù„ ÙÙŠ Ø±Ø¯ÙˆØ¯ ØªØ§Ù„ÙŠØ© Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø£Ø­Ø±Ù]

        // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª
        function updateTransferOptions() {
            document.getElementById('remainingTransfers').textContent = gameData.currentUser.transfersRemaining;
            
            // Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ¹
            const sellSelect = document.getElementById('sellPlayer');
            sellSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ Ù„Ù„Ø¨ÙŠØ¹</option>';
            
            const team = gameData.currentUser.team;
            Object.keys(team).forEach(position => {
                if (['captain', 'tripleCaptain', 'tripleCaptainUsed', 'benchBoostUsed', 'benchBoostRound'].includes(position) || !team[position]) return;
                
                const option = document.createElement('option');
                option.value = position;
                option.textContent = `${team[position].name} (${team[position].team}) - ${team[position].price} Ù…Ù„ÙŠÙˆÙ†`;
                sellSelect.appendChild(option);
            });
            
            // Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
            const buySelect = document.getElementById('buyPlayer');
            buySelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ Ù„Ù„Ø´Ø±Ø§Ø¡</option>';
            
            gameData.players.forEach(player => {
                // ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„ÙŠØ³ ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚
                const isInTeam = Object.values(team).some(selectedPlayer => 
                    selectedPlayer && selectedPlayer.id === player.id
                );
                
                if (!isInTeam) {
                    const option = document.createElement('option');
                    option.value = player.id;
                    option.textContent = `${player.name} (${player.team}) - ${player.price} Ù…Ù„ÙŠÙˆÙ†`;
                    buySelect.appendChild(option);
                }
            });
            
            // Ø®ÙŠØ§Ø±Ø§Øª Ù†Ù‚Ù„ Ø§Ù„Ø¨Ø¯Ù„Ø§Ø¡ Ù„Ù„Ø£Ø³Ø§Ø³ÙŠ
            const subSelect = document.getElementById('substituteToMain');
            subSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø¯Ù„Ø§Ø¡</option>';
            
            ['substitute1', 'substitute2'].forEach(position => {
                if (team[position]) {
                    const option = document.createElement('option');
                    option.value = position;
                    option.textContent = `${team[position].name} (${team[position].team})`;
                    subSelect.appendChild(option);
                }
            });
        }

        // Ù†Ù‚Ù„ Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø¯Ù„Ø§Ø¡ Ù„Ù„Ø£Ø³Ø§Ø³ÙŠ
        function moveToMain() {
            if (isGameweekActive()) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù†Ù‚Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¬Ø§Ø±ÙŠØ©!');
                return;
            }
            const subPosition = document.getElementById('substituteToMain').value;
            
            if (!subPosition) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø¯Ù„Ø§Ø¡');
                return;
            }
            
            const subPlayer = gameData.currentUser.team[subPosition];
            if (!subPlayer) {
                alert('Ø§Ù„Ù„Ø§Ø¹Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø±ÙƒØ² ÙØ§Ø±Øº ÙÙŠ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            let targetPosition = null;
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø±ÙƒØ² ÙØ§Ø±Øº Ù…Ù†Ø§Ø³Ø¨ Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù„Ø§Ø¹Ø¨
            if (subPlayer.position === 'goalkeeper' && !gameData.currentUser.team.goalkeeper) {
                targetPosition = 'goalkeeper';
            } else if (subPlayer.position === 'defender' && !gameData.currentUser.team.defender) {
                targetPosition = 'defender';
            } else if (subPlayer.position === 'midfielder') {
                if (!gameData.currentUser.team.midfielder1) targetPosition = 'midfielder1';
                else if (!gameData.currentUser.team.midfielder2) targetPosition = 'midfielder2';
            } else if (subPlayer.position === 'forward' && !gameData.currentUser.team.forward) {
                targetPosition = 'forward';
            }
            
            if (!targetPosition) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø±ÙƒØ² ÙØ§Ø±Øº Ù…Ù†Ø§Ø³Ø¨ ÙÙŠ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©');
                return;
            }
            
            // Ù†Ù‚Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨
            gameData.currentUser.team[targetPosition] = subPlayer;
            gameData.currentUser.team[subPosition] = null;
            
            updateUserData();
            updateTransferOptions();
            updateUI();
            
            alert(`ØªÙ… Ù†Ù‚Ù„ ${subPlayer.name} Ù„Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©`);
        }

        // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†
        function updateLeaderboards() {
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
            const totalSorted = [...gameData.users].sort((a, b) => (b.totalPoints || 0) - (a.totalPoints || 0));
            const totalContainer = document.getElementById('totalLeaderboard');
            totalContainer.innerHTML = '';
            
            totalSorted.forEach((user, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                
                let rankClass = '';
                if (index === 0) rankClass = 'gold';
                else if (index === 1) rankClass = 'silver';
                else if (index === 2) rankClass = 'bronze';
                
                item.innerHTML = `
                    <div class="rank ${rankClass}">${index + 1}</div>
                    <div class="user-info">
                        <div class="username">${user.username}</div>
                        <div style="font-size: 0.9rem; color: #bbb;">${user.teamName}</div>
                    </div>
                    <div class="points">${user.totalPoints || 0}</div>
                `;
                
                totalContainer.appendChild(item);
            });
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const roundSorted = [...gameData.users].sort((a, b) => {
                const aPoints = a.roundPoints ? (a.roundPoints[gameData.currentRound] || 0) : 0;
                const bPoints = b.roundPoints ? (b.roundPoints[gameData.currentRound] || 0) : 0;
                return bPoints - aPoints;
            });
            
            const roundContainer = document.getElementById('roundLeaderboard');
            roundContainer.innerHTML = '';
            
            roundSorted.forEach((user, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                
                let rankClass = '';
                if (index === 0) rankClass = 'gold';
                else if (index === 1) rankClass = 'silver';
                else if (index === 2) rankClass = 'bronze';
                
                const roundPoints = user.roundPoints ? (user.roundPoints[gameData.currentRound] || 0) : 0;
                
                item.innerHTML = `
                    <div class="rank ${rankClass}">${index + 1}</div>
                    <div class="user-info">
                        <div class="username">${user.username}</div>
                        <div style="font-size: 0.9rem; color: #bbb;">${user.teamName}</div>
                    </div>
                    <div class="points">${roundPoints}</div>
                `;
                
                roundContainer.appendChild(item);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        function updatePlayerStats() {
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨
            const playersWithStats = gameData.players.map(player => {
                const totalGoals = Object.values(player.stats.rounds).reduce((sum, round) => sum + (round.goals || 0), 0);
                const totalAssists = Object.values(player.stats.rounds).reduce((sum, round) => sum + (round.assists || 0), 0);
                const totalYellowCards = Object.values(player.stats.rounds).reduce((sum, round) => sum + (round.yellowCards || 0), 0);
                const totalRedCards = Object.values(player.stats.rounds).reduce((sum, round) => sum + (round.redCards || 0), 0);
                
                return {
                    ...player,
                    totalGoals,
                    totalAssists,
                    totalYellowCards,
                    totalRedCards
                };
            });
            
            // Ø£ÙƒØ«Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ØªÙ‡Ø¯ÙŠÙØ§Ù‹
            const topScorers = [...playersWithStats].sort((a, b) => b.totalGoals - a.totalGoals).slice(0, 10);
            updateStatLeaderboard('topScorers', topScorers, 'totalGoals', 'Ù‡Ø¯Ù');
            
            // Ø£ÙƒØ«Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ØªÙ…Ø±ÙŠØ±Ø§Ù‹ Ø­Ø§Ø³Ù…Ø§Ù‹
            const topAssisters = [...playersWithStats].sort((a, b) => b.totalAssists - a.totalAssists).slice(0, 10);
            updateStatLeaderboard('topAssisters', topAssisters, 'totalAssists', 'ØªÙ…Ø±ÙŠØ±Ø©');
            
            // Ø£ÙƒØ«Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¥Ù†Ø°Ø§Ø±Ø§Ù‹
            const mostYellow = [...playersWithStats].sort((a, b) => b.totalYellowCards - a.totalYellowCards).slice(0, 10);
            updateStatLeaderboard('mostYellowCards', mostYellow, 'totalYellowCards', 'Ø¥Ù†Ø°Ø§Ø±');
            
            // Ø£ÙƒØ«Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø·Ø±Ø¯Ø§Ù‹
            const mostRed = [...playersWithStats].sort((a, b) => b.totalRedCards - a.totalRedCards).slice(0, 10);
            updateStatLeaderboard('mostRedCards', mostRed, 'totalRedCards', 'Ø·Ø±Ø¯');
        }

        // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø­Ø¯Ø¯Ø©
        function updateStatLeaderboard(containerId, players, statKey, statLabel) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            players.forEach((player, index) => {
                if (player[statKey] === 0 && index > 2) return; // Ù„Ø§ ØªØ¸Ù‡Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø¯ÙˆÙ† Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ 3
                
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                
                let rankClass = '';
                if (index === 0) rankClass = 'gold';
                else if (index === 1) rankClass = 'silver';
                else if (index === 2) rankClass = 'bronze';
                
                item.innerHTML = `
                    <div class="rank ${rankClass}">${index + 1}</div>
                    <div class="user-info">
                        <div class="username">${player.name}</div>
                        <div style="font-size: 0.9rem; color: #bbb;">${player.team}</div>
                    </div>
                    <div class="points">${player[statKey]} ${statLabel}</div>
                `;
                
                container.appendChild(item);
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚ÙŠ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        function updateAdminMatchesList() {
            const container = document.getElementById('adminMatchesList');
            container.innerHTML = '';
            
            gameData.matches.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'card';
                matchDiv.innerHTML = `
                    <h5>${match.team1} VS ${match.team2}</h5>
                    <p>Ø§Ù„Ø¬ÙˆÙ„Ø©: ${gameData.rounds.find(r => r.id === match.roundId)?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}</p>
                    <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(match.dateTime).toLocaleDateString('ar-EG')}</p>
                    <p>Ø§Ù„Ø­Ø§Ù„Ø©: ${match.status === 'upcoming' ? 'Ù‚Ø§Ø¯Ù…Ø©' : 'Ø§Ù†ØªÙ‡Øª'}</p>
                    ${match.score.team1 !== null ? `<p>Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${match.score.team1} - ${match.score.team2}</p>` : ''}
                    <button onclick="editMatch(${match.id})" class="btn btn-warning">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
                    <button onclick="deleteMatch(${match.id})" class="btn btn-danger">Ø­Ø°Ù</button>
                `;
                container.appendChild(matchDiv);
            });
        }

        function addTeam() {
            const teamName = document.getElementById('newTeamName').value.trim();
            if (!teamName) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚');
                return;
            }
            
            if (gameData.teams.find(t => t.name === teamName)) {
                alert('Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
                return;
            }
            
            const newTeam = {
                id: Date.now(),
                name: teamName
            };
            
            gameData.teams.push(newTeam);
            document.getElementById('newTeamName').value = '';
            saveGameData();
            updateTeamsList();
            updateTeamOptions();
            
            alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function updateTeamsList() {
            const container = document.getElementById('teamsList');
            container.innerHTML = '';
            
            gameData.teams.forEach(team => {
                const teamDiv = document.createElement('div');
                teamDiv.className = 'card';
                teamDiv.innerHTML = `
                    <h5>${team.name}</h5>
                    <button onclick="deleteTeam(${team.id})" class="btn btn-danger">Ø­Ø°Ù</button>
                `;
                container.appendChild(teamDiv);
            });
        }

        function updatePlayerTeamOptions() {
            const select = document.getElementById('newPlayerTeam');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚</option>';
            
            gameData.teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.name;
                option.textContent = team.name;
                select.appendChild(option);
            });
        }

        function savePlayer() {
            const playerId = document.getElementById('editPlayerId').value;
            const name = document.getElementById('newPlayerName').value.trim();
            const team = document.getElementById('newPlayerTeam').value;
            const position = document.getElementById('newPlayerPosition').value;
            const price = parseFloat(document.getElementById('newPlayerPrice').value);
            
            if (!name || !team || !position || !price) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨');
                return;
            }
            
            if (price <= 0) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­ Ù„Ù„Ø§Ø¹Ø¨');
                return;
            }
            
            if (playerId) { // Edit existing player
                const playerIndex = gameData.players.findIndex(p => p.id === parseInt(playerId));
                if (playerIndex !== -1) {
                    gameData.players[playerIndex].name = name;
                    gameData.players[playerIndex].team = team;
                    gameData.players[playerIndex].position = position;
                    gameData.players[playerIndex].price = price;
                    alert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                }
            } else { // Add new player
            const newPlayer = {
                id: Date.now(),
                name,
                team,
                position,
                price,
                stats: { rounds: {} },
                injured: false
            };
            gameData.players.push(newPlayer);
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
            }
            
            // Clear form and reset edit state
            document.getElementById('editPlayerId').value = '';
            document.getElementById('newPlayerName').value = '';
            document.getElementById('newPlayerTeam').value = '';
            document.getElementById('newPlayerPosition').value = 'goalkeeper';
            document.getElementById('newPlayerPrice').value = '';
            document.getElementById('savePlayerBtn').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨';
            
            saveGameData();
            updatePlayersAdminList();
            updatePlayerPointsOptions(); // Update options for points management
        }

        function editPlayer(playerId) {
            const player = gameData.players.find(p => p.id === playerId);
            if (player) {
                document.getElementById('editPlayerId').value = player.id;
                document.getElementById('newPlayerName').value = player.name;
                document.getElementById('newPlayerTeam').value = player.team;
                document.getElementById('newPlayerPosition').value = player.position;
                document.getElementById('newPlayerPrice').value = player.price;
                document.getElementById('savePlayerBtn').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨';
            }
        }

        function updatePlayersAdminList() {
            const container = document.getElementById('playersAdminList');
            container.innerHTML = '';

            gameData.players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'card';
                playerDiv.innerHTML = `
                    <h5>${player.name} (${player.team})</h5>
                    <p>Ø§Ù„Ù…Ø±ÙƒØ²: ${player.position}</p>
                    <p>Ø§Ù„Ø³Ø¹Ø±: ${player.price} Ù…Ù„ÙŠÙˆÙ†</p>
                    <button onclick="editPlayer(${player.id})" class="btn btn-warning">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button onclick="deletePlayer(${player.id})" class="btn btn-danger">Ø­Ø°Ù</button>
                `;
                container.appendChild(playerDiv);
            });
        }

        function updatePlayerPointsOptions() {
            const select = document.getElementById('pointsPlayerId');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù„Ø§Ø¹Ø¨</option>';
            
            gameData.players.forEach(player => {
                const option = document.createElement('option');
                option.value = player.id;
                option.textContent = `${player.name} (${player.team})`;
                select.appendChild(option);
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„ØªØµØ¯ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±ÙƒØ²
            select.addEventListener('change', function() {
                const playerId = parseInt(this.value);
                const player = gameData.players.find(p => p.id === playerId);
                const savesGroup = document.getElementById('savesMGroup');
                
                if (player && player.position === 'goalkeeper') {
                    savesGroup.style.display = 'block';
                } else {
                    savesGroup.style.display = 'none';
                }
            });
        }

        function updatePointsRoundOptions() {
            const select = document.getElementById('pointsRound');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬ÙˆÙ„Ø©</option>';
            
            gameData.rounds.forEach(round => {
                const option = document.createElement('option');
                option.value = round.id;
                option.textContent = round.name;
                select.appendChild(option);
            });
        }

        function updatePlayerPoints() {
            const playerId = parseInt(document.getElementById('pointsPlayerId').value);
            const roundId = parseInt(document.getElementById('pointsRound').value);
            const directPoints = parseInt(document.getElementById('directPoints').value) || 0;
            const goals = parseInt(document.getElementById('playerGoals').value) || 0;
            const assists = parseInt(document.getElementById('playerAssists').value) || 0;
            const yellowCards = parseInt(document.getElementById('playerYellowCards').value) || 0;
            const redCards = parseInt(document.getElementById('playerRedCards').value) || 0;
            const saves = parseInt(document.getElementById('playerSaves').value) || 0;
            const injured = document.getElementById('playerInjured').checked;
            
            if (!playerId || !roundId) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨ ÙˆØ¬ÙˆÙ„Ø©');
                return;
            }
            
            const playerIndex = gameData.players.findIndex(p => p.id === playerId);
            if (playerIndex === -1) {
                alert('Ø§Ù„Ù„Ø§Ø¹Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨
            if (!gameData.players[playerIndex].stats.rounds[roundId]) {
                gameData.players[playerIndex].stats.rounds[roundId] = {};
            }
            
            gameData.players[playerIndex].stats.rounds[roundId] = {
                directPoints,
                goals,
                assists,
                yellowCards,
                redCards,
                saves,
                injured
            };
            
            gameData.players[playerIndex].injured = injured;
            
            saveGameData();
            
            // ØªØ­Ø¯ÙŠØ« Ù†Ù‚Ø§Ø· Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            updateAllUserPoints();
            
            alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Ù‚Ø§Ø· Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØ­Ø¯ÙŠØ« Ù†Ù‚Ø§Ø· Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function updateAllUserPoints() {
            gameData.users.forEach(user => {
                let totalPoints = 0;
                const roundPoints = {};
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø¬ÙˆÙ„Ø©
                gameData.rounds.forEach(round => {
                    let roundTotal = 0;
                    
                    const team = user.team;
                    Object.keys(team).forEach(position => {
                        if (['captain', 'tripleCaptain', 'tripleCaptainUsed', 'benchBoostUsed', 'benchBoostRound'].includes(position) || !team[position]) return;
                        
                        const player = gameData.players.find(p => p.id === team[position].id);
                        if (!player) return;
                        
                        const playerRoundStats = player.stats.rounds[round.id] || {};
                        let playerPoints = playerRoundStats.directPoints || 0;
                        
                        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                        playerPoints += (playerRoundStats.goals || 0) * 4;
                        playerPoints += (playerRoundStats.assists || 0) * 3;
                        playerPoints -= (playerRoundStats.yellowCards || 0) * 1;
                        playerPoints -= (playerRoundStats.redCards || 0) * 3;
                        
                        if (player.position === 'goalkeeper') {
                            playerPoints += (playerRoundStats.saves || 0) * 1;
                        }
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥ØµØ§Ø¨Ø© ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…ØµØ§Ø¨
                        if (playerRoundStats.injured && !['substitute1', 'substitute2'].includes(position)) {
                            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø³Ø§Ø¯Ø³ (Ø£ÙˆÙ„ Ø¨Ø¯ÙŠÙ„)
                            if (team.substitute1) {
                                const substitute = gameData.players.find(p => p.id === team.substitute1.id);
                                if (substitute && !substitute.stats.rounds[round.id]?.injured) {
                                    const subStats = substitute.stats.rounds[round.id] || {};
                                    playerPoints = subStats.directPoints || 0;
                                    playerPoints += (subStats.goals || 0) * 4;
                                    playerPoints += (subStats.assists || 0) * 3;
                                    playerPoints -= (subStats.yellowCards || 0) * 1;
                                    playerPoints -= (subStats.redCards || 0) * 3;
                                    
                                    if (substitute.position === 'goalkeeper') {
                                        playerPoints += (subStats.saves || 0) * 1;
                                    }
                                }
                            }
                        }
                        
                        // ØªØ·Ø¨ÙŠÙ‚ Ø¶Ø§Ø¹Ù Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ø£Ùˆ Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ†
                        if (team.captain === player.id) {
                            if (team.tripleCaptain === player.id && team.tripleCaptainRound === round.id) {
                                playerPoints *= 3; // Ø§Ù„ØªØ±ÙŠØ¨Ù„ ÙƒØ§Ø¨ØªÙ†
                            } else {
                                playerPoints *= 2; // Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                            }
                        }
                        
                        roundTotal += Math.max(0, playerPoints);
                    });
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨Ø¯Ù„Ø§Ø¡ Ø¥Ø°Ø§ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠÙ†Ø´ Ø¨ÙˆØ³Øª
                    if (team.benchBoostRound === round.id) {
                        ['substitute1', 'substitute2'].forEach(position => {
                            if (team[position]) {
                                const player = gameData.players.find(p => p.id === team[position].id);
                                if (player) {
                                    const playerRoundStats = player.stats.rounds[round.id] || {};
                                    let benchPlayerPoints = playerRoundStats.directPoints || 0;
                                    benchPlayerPoints += (playerRoundStats.goals || 0) * 4;
                                    benchPlayerPoints += (playerRoundStats.assists || 0) * 3;
                                    benchPlayerPoints -= (playerRoundStats.yellowCards || 0) * 1;
                                    benchPlayerPoints -= (playerRoundStats.redCards || 0) * 3;
                                    
                                    if (player.position === 'goalkeeper') {
                                        benchPlayerPoints += (playerRoundStats.saves || 0) * 1;
                                    }
                                    
                                    roundTotal += Math.max(0, benchPlayerPoints);
                                }
                            }
                        });
                    }
                    
                    roundPoints[round.id] = roundTotal;
                    totalPoints += roundTotal;
                });
                
                user.totalPoints = totalPoints;
                user.roundPoints = roundPoints;
            });
            
            saveGameData();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¶Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø«ÙŠÙ†
            const currentUserUpdated = gameData.users.find(u => u.id === gameData.currentUser.id);
            if (currentUserUpdated) {
                gameData.currentUser = currentUserUpdated;
                localStorage.setItem('currentUser', JSON.stringify(gameData.currentUser));
                updateTeamStats();
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
        });

        async function deleteTeam(teamId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙØ±ÙŠÙ‚ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø±ØªØ¨Ø·ÙŠÙ† Ø¨Ù‡ Ø£ÙŠØ¶Ø§Ù‹.')) {
                const deleteRes = await callApi(`teams.php?id=${teamId}`, 'DELETE');

                if (deleteRes && deleteRes.status === 'success') {
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ±ÙŠÙ‚ ÙˆØ¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø±ØªØ¨Ø·ÙŠÙ† Ø¨Ù‡ Ø¨Ù†Ø¬Ø§Ø­!');
                    await updateAdminData(); // Refresh all admin lists
                } else {
                    alert(deleteRes.message || 'ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ÙØ±ÙŠÙ‚. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                }
            }
        }

        async function confirmDeleteUser() {
            const usernameToDelete = document.getElementById('deleteUserSearch').value.trim();
            if (!usernameToDelete) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø­Ø°Ù');
                return;
            }

            const user = gameData.users.find(u => u.username === usernameToDelete);
            if (!user) {
                alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }

            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${usernameToDelete}ØŸ`)) {
                deleteUser(user.id);
            }
        }

        function deleteUser(userId) {
            gameData.users = gameData.users.filter(user => user.id !== userId);
            saveGameData();
            // Optionally, clear the search input
            document.getElementById('deleteUserSearch').value = '';
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
            updateAdminData(); // Refresh admin user list
        }

        function deletePlayer(playerId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ØŸ')) {
                const deletedPlayer = gameData.players.find(p => p.id === playerId);
                gameData.players = gameData.players.filter(player => player.id !== playerId);

                if (deletedPlayer) {
                    gameData.users.forEach(user => {
                        let userTeamChanged = false;
                        Object.keys(user.team).forEach(position => {
                            if (user.team[position] && user.team[position].id === playerId) {
                                user.team[position] = null;
                                user.budget += deletedPlayer.price;
                                user.transfersRemaining++; // Grant a free transfer
                                userTeamChanged = true;
                                alert(`ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ ${deletedPlayer.name} Ù…Ù† ÙØ±ÙŠÙ‚ ${user.teamName} ÙˆØ¥Ø¹Ø§Ø¯Ø© ${deletedPlayer.price} Ù…Ù„ÙŠÙˆÙ† Ù„Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©. ÙˆØªÙ… Ù…Ù†Ø­ ØªØ¨Ø¯ÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ.`);
                            }
                        });
                        
                        // Also check for captain/triple captain
                        if (user.team.captain === playerId) user.team.captain = null;
                        if (user.team.tripleCaptain === playerId) user.team.tripleCaptain = null;

                        if (userTeamChanged) {
                            const userIndex = gameData.users.findIndex(u => u.id === user.id);
                            if (userIndex !== -1) {
                                gameData.users[userIndex] = user;
                                if (gameData.currentUser && gameData.currentUser.id === user.id) {
                                    gameData.currentUser = user;
                                    localStorage.setItem('currentUser', JSON.stringify(user));
                                    updateUI(); // Ensure UI is updated for current user if their team was affected
                                }
                            }
                        }
                    });
                }
                saveGameData();
                updatePlayersAdminList();
                updatePlayerPointsOptions(); // Update options for points management
                // Additionally, force a general UI update for the current user in case of any remaining inconsistencies.
                if (gameData.currentUser) {
                    updateUI(); 
                }
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        // Helper to check if current gameweek is active
        function isGameweekActive() {
            const currentRound = gameData.rounds.find(r => r.id === gameData.currentRound);
            if (!currentRound) return false;

            const now = new Date();
            const startDate = new Date(currentRound.startDate);
            const endDate = new Date(currentRound.endDate);

            return now >= startDate && now <= endDate;
        }

        // Helper to determine if user is still in initial team building phase
        function isInitialTeamBuildingPhase() {
            if (!gameData.currentUser || !gameData.currentUser.team) return false;
            const filledSlotsCount = Object.keys(gameData.currentUser.team)
                                        .filter(key => !['captain', 'tripleCaptain', 'tripleCaptainUsed', 'benchBoostUsed', 'benchBoostRound', 'freeTransfers'].includes(key))
                                        .filter(key => gameData.currentUser.team[key] !== null)
                                        .length;
            return filledSlotsCount < 7; // Assuming 7 main players (GK, DEF, MID1, MID2, FWD, SUB1, SUB2)
        }

        // ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª
        async function toggleTransferMode() {
            if (isGameweekActive()) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¬Ø§Ø±ÙŠØ©!');
                return;
            }

            gameData.isTransferMode = !gameData.isTransferMode;
            const toggleBtn = document.getElementById('toggleTransferModeBtn');
            const transferActionButtons = document.getElementById('transferActionButtons');

            if (gameData.isTransferMode) {
                // Enter transfer mode
                gameData.stagedTeam = { ...gameData.currentUser.team };
                gameData.stagedBudget = gameData.currentUser.budget;
                toggleBtn.textContent = 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª';
                transferActionButtons.classList.remove('hidden');
            } else {
                // Exit transfer mode (implicitly discard changes if not saved)
                gameData.stagedTeam = null;
                gameData.stagedBudget = 0;
                toggleBtn.textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª';
                transferActionButtons.classList.add('hidden');
            }
            updateUI();
        }

        // Handle clicks on player slots
        async function handlePlayerSlotClick(slotKey) {
            if (!gameData.currentUser) {
                alert('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }

            // Allow initial team building (up to 7 players) without transfer mode
            if (isInitialTeamBuildingPhase()) {
                await openPlayerSelection(slotKey, true); // Force open selection if team is not full yet
            } else if (gameData.isTransferMode) {
                const playerInSlot = gameData.stagedTeam[slotKey];
                if (playerInSlot) {
                    // Remove player from staged team
                    gameData.stagedBudget += playerInSlot.price;
                    gameData.stagedTeam[slotKey] = null;
                    await updateUI(); // Refresh UI to reflect removal and budget change
                } else {
                    // Open selection for empty slot in transfer mode
                    await openPlayerSelection(slotKey);
                }
            } else {
                alert('Ù„Ø¥Ø¬Ø±Ø§Ø¡ ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
            }
        }

        // Ø­ÙØ¸ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª
        function saveTransfers() {
            if (isGameweekActive()) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¬Ø§Ø±ÙŠØ©!');
                return;
            }

            let transfersMade = 0;
            const currentTeam = gameData.currentUser.team;
            const stagedTeam = gameData.stagedTeam;

            // Compare currentTeam with stagedTeam to count actual changes
            Object.keys(currentTeam).forEach(position => {
                // Exclude captain and power-up related properties
                if (['captain', 'tripleCaptain', 'tripleCaptainUsed', 'benchBoostUsed', 'benchBoostRound', 'freeTransfers'].includes(position)) return;

                const currentPlayer = currentTeam[position];
                const stagedPlayer = stagedTeam[position];

                if (currentPlayer && !stagedPlayer) {
                    transfersMade++; // Player removed
                } else if (!currentPlayer && stagedPlayer) {
                    transfersMade++; // Player added to an empty slot
                } else if (currentPlayer && stagedPlayer && currentPlayer.id !== stagedPlayer.id) {
                    transfersMade++; // Player swapped
                }
            });

            // Apply transfer limits only if actual transfers were made
            if (transfersMade > 0) {
                if (gameData.currentUser.freeTransfers > 0) {
                    gameData.currentUser.freeTransfers--;
                    alert(`ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ¨Ø¯ÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ. ØªØ¨Ù‚Ù‰ Ù„Ø¯ÙŠÙƒ ${gameData.currentUser.freeTransfers} ØªØ¨Ø¯ÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ.`);
                } else if (gameData.currentUser.transfersRemaining > 0) {
                    gameData.currentUser.transfersRemaining--;
                    alert(`ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ØªØ¨Ù‚Ù‰ Ù„Ø¯ÙŠÙƒ ${gameData.currentUser.transfersRemaining} ØªØ¨Ø¯ÙŠÙ„ Ù…Ø¯ÙÙˆØ¹.`);
                } else {
                    alert('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª. ÙŠØ±Ø¬Ù‰ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª Ø£Ùˆ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.');
                    return; // Prevent saving if no transfers remaining
                }
            }

            // Finalize changes
            gameData.currentUser.team = { ...gameData.stagedTeam };
            gameData.currentUser.budget = gameData.stagedBudget;

            gameData.isTransferMode = false;
            gameData.stagedTeam = null;
            gameData.stagedBudget = 0;
            updateUserData();
            updateUI();

            // Reset the toggle button text after saving
            document.getElementById('toggleTransferModeBtn').textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª';
            document.getElementById('transferActionButtons').classList.add('hidden');
        }

        // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª
        function discardTransfers() {
            gameData.isTransferMode = false;
            gameData.stagedTeam = null;
            gameData.stagedBudget = 0;
            updateUI();

            // Reset the toggle button text after discarding
            document.getElementById('toggleTransferModeBtn').textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª';
            document.getElementById('transferActionButtons').classList.add('hidden');
        }

        function updateUsersList() {
            const container = document.getElementById('usersAdminList');
            container.innerHTML = '';
            gameData.users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'card';
                userDiv.innerHTML = `
                    <h5>${user.username} - ${user.teamName}</h5>
                    <p>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: ${user.totalPoints || 0}</p>
                    <button onclick="deleteUser(${user.id})" class="btn btn-danger">Ø­Ø°Ù</button>
                `;
                container.appendChild(userDiv);
            });
        }

        function confirmDeleteUser() {
            const usernameToDelete = document.getElementById('deleteUserSearch').value.trim();
            if (!usernameToDelete) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø­Ø°Ù');
                return;
            }
            const user = gameData.users.find(u => u.username === usernameToDelete);
            if (!user) {
                alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${usernameToDelete}ØŸ`)) {
                deleteUser(user.id);
            }
        }

        function deleteUser(userId) {
            gameData.users = gameData.users.filter(user => user.id !== userId);
            saveGameData();
            document.getElementById('deleteUserSearch').value = '';
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
            updateUsersList(); // Refresh admin user list
            // Optionally, if the deleted user was the current user, log them out
            if (gameData.currentUser && gameData.currentUser.id === userId) {
                logout();
            }
        }
    </script>
</body>
</html>
</html>